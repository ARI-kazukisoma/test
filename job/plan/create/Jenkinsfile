def input_param = null
pipeline {
  agent {node { label 'master' }}
  parameters {
    string(name: 'UUID', description: 'UUID')
  }
  stages {
    stage("jsonファイルからパラメータ取得") {
      steps {
        script {
          def json = load("lib/json.groovy")
          def filePath = "${env.TMP_PARAMETER_PATH}/${params.UUID}.json"
          input_param = json.read(filePath)
          json.delete(filePath)
        }
      }
    }
    stage("インフラ作成") {
      steps {
        script {
          echo input_param.ENV
          def parameters = [
            [
              $class: 'StringParameterValue',
              name: 'ENV',
              value: input_param.ENV
            ]

          ]
          build job: 'インフラ開発環境構築', parameters: parameters
        }
      }
    }
    stage("マスターデータ更新") {
      steps {
        script {
          echo "マスターデータ更新"
        }
      }
    }
    stage("アプリバージョン更新") {
      steps {
        script {
          echo "アプリバージョン更新"
        }
      }
    }
  }
  post {
    success {
        echo "OK"
    }
    always {
        echo "Always"
    }
    failure {
        echo "NG"
    }
  }
}